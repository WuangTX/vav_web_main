{% extends 'base.html' %}
{% load static %}
{% load humanize %}

{% block title %}{{ project.title }} - VAV Furniture{% endblock %}

{% block content %}
<!-- Page Header -->
<section class="page-header">
    <div class="container">
        <div class="page-header-content text-center">
            <h1 class="display-4 fw-bold">{{ project.title }}</h1>
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb justify-content-center">
                    <li class="breadcrumb-item"><a href="{% url 'home' %}" class="text-white">Trang Chủ</a></li>
                    <li class="breadcrumb-item"><a href="{% url 'projects' %}" class="text-white">Dự Án</a></li>
                    <li class="breadcrumb-item active text-white" aria-current="page">{{ project.title }}</li>
                </ol>
            </nav>
        </div>
    </div>
</section>

<!-- Project Detail Section -->
<section class="project-detail-section py-5">
    <div class="container">
        <div class="row">
            <!-- Project Image -->
            <div class="col-lg-6 mb-4 mb-lg-0">
                <div class="project-detail-image">
                    <img src="{{ project.image.url }}" alt="{{ project.title }}" class="img-fluid rounded shadow">
                </div>
            </div>
            
            <!-- Project Info -->
            <div class="col-lg-6">
                <div class="project-detail-info">
                    <h2 class="mb-3">{{ project.title }}</h2>
                    
                    <div class="project-type mb-3">
                        <span class="badge bg-primary">{{ project.get_project_type_display }}</span>
                    </div>
                      <div class="project-info-grid mb-4">
                        <div class="row g-3">
                            <div class="col-6">
                                <div class="info-item">
                                    <strong>Khách Hàng:</strong> {{ project.client }}
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="info-item">
                                    <strong>Địa Điểm:</strong> {{ project.location }}
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="info-item">
                                    <strong>Hoàn Thành:</strong> {{ project.completed_date|date:"d/m/Y" }}
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="info-item">
                                    <strong>Loại Dự Án:</strong> {{ project.get_project_type_display }}
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="project-description mb-4">
                        <h5>Mô Tả Dự Án</h5>
                        <p>{{ project.description }}</p>
                    </div>
                    
                    <div class="project-features mb-4">
                        <h5>Đặc Điểm Nổi Bật</h5>
                        <ul class="list-unstyled">
                            <li><i class="fas fa-check-circle text-primary me-2"></i> Thiết kế độc đáo, phù hợp với không gian</li>
                            <li><i class="fas fa-check-circle text-primary me-2"></i> Sử dụng vật liệu cao cấp, bền đẹp</li>
                            <li><i class="fas fa-check-circle text-primary me-2"></i> Thi công chuyên nghiệp, đúng tiến độ</li>
                            <li><i class="fas fa-check-circle text-primary me-2"></i> Bảo hành dài hạn, hỗ trợ sau bán hàng</li>
                        </ul>
                    </div>
                    
                    <div class="project-actions">
                        <a href="{% url 'contact' %}" class="btn btn-primary me-2">
                            <i class="fas fa-phone me-2"></i>Liên Hệ Tư Vấn
                        </a>
                        <a href="#" class="btn btn-outline-primary">
                            <i class="fas fa-share-alt me-2"></i>Chia Sẻ
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Project Gallery Section -->
<section class="project-gallery-section py-5 bg-light">
    <div class="container">
        <div class="section-heading text-center mb-5">
            <h6 class="text-primary">Hình Ảnh Dự Án</h6>
            <h2>Thư Viện Ảnh</h2>
        </div>
          {% if gallery_images %}
        <div class="row g-4">
            {% for gallery_image in gallery_images %}
            <div class="col-md-4 col-sm-6">
                <div class="gallery-item" data-bs-toggle="modal" data-bs-target="#galleryModal" data-slide="{{ forloop.counter0 }}">
                    <div class="gallery-image-container">
                        <img src="{{ gallery_image.image.url }}" alt="{{ gallery_image.title|default:project.title }}" class="img-fluid rounded">
                        <div class="gallery-overlay">
                            <div class="gallery-overlay-content">
                                <i class="fas fa-expand fa-2x"></i>
                                <p class="mt-2">Xem ảnh</p>
                            </div>
                        </div>
                        {% if gallery_image.title %}
                        <div class="gallery-caption-thumb">
                            <p>{{ gallery_image.title }}</p>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <!-- Fallback to main project image if no gallery images -->
        <div class="row justify-content-center">
            <div class="col-md-8 col-lg-6">
                <div class="gallery-item">
                    <img src="{{ project.image.url }}" alt="{{ project.title }}" class="img-fluid rounded shadow">
                </div>
            </div>
        </div>
        {% endif %}
    </div>
</section>

<!-- Project Timeline Section -->
<section class="project-timeline-section py-5 bg-gradient-light">
    <div class="container">
        <div class="section-heading text-center mb-5">
            <div class="section-title-decoration mb-3">
                <span class="decoration-line"></span>
                <i class="fas fa-tasks text-primary"></i>
                <span class="decoration-line"></span>
            </div>
            <h6 class="text-primary text-uppercase fw-bold ls-2 mb-2">Quy Trình Thực Hiện</h6>
            <h2 class="display-5 fw-bold mb-3">Các Giai Đoạn Dự Án</h2>
            <p class="lead text-muted">Quy trình thực hiện dự án một cách chuyên nghiệp và minh bạch</p>        </div>
          {% if timeline_entries %}
        <!-- Dynamic Timeline -->
        <div class="row">
            <div class="col-lg-10 mx-auto">
                <div class="modern-timeline">
                    {% for entry in timeline_entries %}
                    <div class="timeline-item" data-aos="fade-up" data-aos-delay="{% cycle '100' '200' '300' '400' '500' %}">
                        <div class="timeline-marker">
                            <div class="timeline-icon status-{{ entry.status }}">
                                {% if entry.status == 'consultation' %}
                                    <i class="fas fa-lightbulb"></i>
                                {% elif entry.status == 'planning' %}
                                    <i class="fas fa-drafting-compass"></i>
                                {% elif entry.status == 'production' %}
                                    <i class="fas fa-cogs"></i>
                                {% elif entry.status == 'installation' %}
                                    <i class="fas fa-hammer"></i>
                                {% elif entry.status == 'completion' %}
                                    <i class="fas fa-trophy"></i>
                                {% else %}
                                    <i class="fas fa-circle"></i>
                                {% endif %}
                            </div>
                        </div>
                        <div class="timeline-content">
                            <div class="timeline-card">
                                <div class="card-header">
                                    <span class="step-number">{{ forloop.counter }}</span>
                                    <h4 class="step-title">{{ entry.title }}</h4>
                                    <span class="status-badge status-{{ entry.status }}">
                                        {{ entry.get_status_display }}
                                    </span>
                                </div>
                                <div class="card-body">
                                    <p class="step-description">{{ entry.description }}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
        {% else %}        <!-- Default Timeline -->
        <div class="row">
            <div class="col-lg-10 mx-auto">
                <div class="modern-timeline">
                    <div class="timeline-item" data-aos="fade-up" data-aos-delay="100">
                        <div class="timeline-marker">
                            <div class="timeline-icon status-consultation">
                                <i class="fas fa-lightbulb"></i>
                            </div>
                        </div>
                        <div class="timeline-content">
                            <div class="timeline-card">
                                <div class="card-header">
                                    <span class="step-number">1</span>
                                    <h4 class="step-title">Tư Vấn & Thiết Kế</h4>
                                    <span class="status-badge status-consultation">Tư Vấn</span>
                                </div>
                                <div class="card-body">
                                    <p class="step-description">Khảo sát thực tế, phân tích nhu cầu khách hàng và tạo ra bản thiết kế tối ưu phù hợp với không gian và phong cách mong muốn.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="timeline-item" data-aos="fade-up" data-aos-delay="200">
                        <div class="timeline-marker">
                            <div class="timeline-icon status-planning">
                                <i class="fas fa-drafting-compass"></i>
                            </div>
                        </div>
                        <div class="timeline-content">
                            <div class="timeline-card">
                                <div class="card-header">
                                    <span class="step-number">2</span>
                                    <h4 class="step-title">Lập Kế Hoạch & Vật Liệu</h4>
                                    <span class="status-badge status-planning">Lập Kế Hoạch</span>
                                </div>
                                <div class="card-body">
                                    <p class="step-description">Xây dựng kế hoạch thi công chi tiết, lựa chọn vật liệu cao cấp và lên lịch thực hiện cụ thể đảm bảo tiến độ.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="timeline-item" data-aos="fade-up" data-aos-delay="300">
                        <div class="timeline-marker">
                            <div class="timeline-icon status-production">
                                <i class="fas fa-cogs"></i>
                            </div>
                        </div>
                        <div class="timeline-content">
                            <div class="timeline-card">
                                <div class="card-header">
                                    <span class="step-number">3</span>
                                    <h4 class="step-title">Sản Xuất & Chế Tác</h4>
                                    <span class="status-badge status-production">Sản Xuất</span>
                                </div>
                                <div class="card-body">
                                    <p class="step-description">Sản xuất nội thất theo thiết kế với công nghệ hiện đại, kiểm soát chất lượng nghiêm ngặt từng sản phẩm.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="timeline-item" data-aos="fade-up" data-aos-delay="400">
                        <div class="timeline-marker">
                            <div class="timeline-icon status-installation">
                                <i class="fas fa-hammer"></i>
                            </div>
                        </div>
                        <div class="timeline-content">
                            <div class="timeline-card">
                                <div class="card-header">
                                    <span class="step-number">4</span>
                                    <h4 class="step-title">Thi Công & Lắp Đặt</h4>
                                    <span class="status-badge status-installation">Thi Công</span>
                                </div>
                                <div class="card-body">
                                    <p class="step-description">Thi công và lắp đặt chuyên nghiệp tại công trình, đảm bảo tiến độ và chất lượng hoàn hảo.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="timeline-item" data-aos="fade-up" data-aos-delay="500">
                        <div class="timeline-marker">
                            <div class="timeline-icon status-completion">
                                <i class="fas fa-trophy"></i>
                            </div>
                        </div>
                        <div class="timeline-content">
                            <div class="timeline-card">
                                <div class="card-header">
                                    <span class="step-number">5</span>
                                    <h4 class="step-title">Nghiệm Thu & Bàn Giao</h4>
                                    <span class="status-badge status-completion">Hoàn Thành</span>
                                </div>
                                <div class="card-body">
                                    <p class="step-description">Hoàn thiện dự án, kiểm tra chất lượng tổng thể và bàn giao công trình hoàn chỉnh cho khách hàng cùng chế độ bảo hành.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
    </div>
</section>

<!-- Lightbox Modal -->
<div id="lightboxModal" class="lightbox-modal" onclick="closeLightbox(event)">
    <div class="lightbox-content">
        <span class="lightbox-close" onclick="closeLightbox()">&times;</span>
        <button class="lightbox-nav lightbox-prev" onclick="changeImage(-1)">
            <i class="fas fa-chevron-left"></i>
        </button>
        <button class="lightbox-nav lightbox-next" onclick="changeImage(1)">
            <i class="fas fa-chevron-right"></i>
        </button>
        <img id="lightboxImage" src="" alt="">
        <div class="lightbox-caption">
            <p id="lightboxTitle"></p>
            <span id="lightboxCounter"></span>
        </div>
    </div>
</div>

<!-- Related Projects Section -->
<section class="related-projects-section py-5 bg-light">
    <div class="container">
        <div class="section-heading text-center mb-5">
            <h6 class="text-primary">Dự Án Tương Tự</h6>
            <h2>Các Dự Án Khác</h2>
        </div>
        
        <div class="row g-4">
            {% for related_project in related_projects %}
            <!-- Related Project Item {{ forloop.counter }} -->
            <div class="col-md-6 col-lg-4">
                <div class="project-card">
                    <div class="project-image">
                        <img src="{{ related_project.image.url }}" alt="{{ related_project.title }}" class="img-fluid">
                        <div class="project-overlay">
                            <div class="project-info">
                                <h5>{{ related_project.title }}</h5>
                                <p><i class="fas fa-map-marker-alt me-1"></i>{{ related_project.location }}</p>
                                <a href="{% url 'project_detail' related_project.slug %}" class="btn btn-sm btn-outline-light">Xem Chi Tiết</a>
                            </div>
                        </div>
                    </div>
                    <div class="project-meta p-3">                        <div class="d-flex justify-content-between align-items-center">
                            <span class="badge bg-primary">{{ related_project.get_project_type_display }}</span>
                            <small class="text-muted">{{ related_project.completed_date|date:"d/m/Y" }}</small>
                        </div>
                    </div>
                </div>
            </div>
            {% empty %}
            <div class="col-12 text-center">
                <p>Không có dự án liên quan.</p>
            </div>
            {% endfor %}
        </div>
    </div>
</section>

<!-- CTA Section -->
<section class="cta-section py-5 bg-primary text-white">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-8 mb-4 mb-lg-0">
                <h2 class="mb-2">Bạn Có Dự Án Tương Tự?</h2>
                <p class="lead mb-0">Hãy liên hệ với chúng tôi để được tư vấn thiết kế và báo giá chi tiết!</p>
            </div>
            <div class="col-lg-4 text-lg-end">
                <a href="{% url 'contact' %}" class="btn btn-light btn-lg">
                    <i class="fas fa-phone me-2"></i>Liên Hệ Ngay
                </a>
            </div>
        </div>    </div>
</section>

<!-- Gallery Modal with Swipe -->
<div class="modal fade" id="galleryModal" tabindex="-1" aria-labelledby="galleryModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-fullscreen">
        <div class="modal-content bg-dark">
            <div class="modal-header border-0">
                <h5 class="modal-title text-white" id="galleryModalLabel">{{ project.title }} - Thư viện ảnh</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body p-0 d-flex align-items-center justify-content-center">
                {% if gallery_images %}
                <div class="swipe-gallery-container">
                    <div class="swipe-gallery" id="modalGallery">
                        <div class="gallery-wrapper">
                            {% for gallery_image in gallery_images %}
                            <div class="gallery-slide {% if forloop.first %}active{% endif %}">
                                <div class="gallery-image-container">
                                    <img src="{{ gallery_image.image.url }}" alt="{{ gallery_image.title|default:project.title }}" class="gallery-image">
                                    {% if gallery_image.title %}
                                    <div class="gallery-caption">
                                        <p>{{ gallery_image.title }}</p>
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                        
                        <!-- Navigation -->
                        <div class="gallery-nav">
                            <button class="gallery-nav-btn prev-btn" id="modalPrevBtn">
                                <i class="fas fa-chevron-left"></i>
                            </button>
                            <button class="gallery-nav-btn next-btn" id="modalNextBtn">
                                <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                        
                        <!-- Counter -->
                        <div class="gallery-counter">
                            <span id="modalCurrentSlide">1</span> / <span id="modalTotalSlides">{{ gallery_images|length }}</span>
                        </div>
                        
                        <!-- Dots indicator -->
                        <div class="gallery-dots">
                            {% for gallery_image in gallery_images %}
                            <span class="dot {% if forloop.first %}active{% endif %}" data-slide="{{ forloop.counter0 }}"></span>
                            {% endfor %}
                        </div>
                    </div>
                </div>
                {% endif %}
            </div>        </div>
    </div>
</div>

{% endblock %}

{% block extra_css %}
<style>
/* Enhanced Timeline Styles */
.bg-gradient-light {
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
}

.section-title-decoration {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 1rem;
}

.decoration-line {
    width: 60px;
    height: 2px;
    background: linear-gradient(90deg, transparent, #007bff, transparent);
}

.ls-2 {
    letter-spacing: 2px;
}

/* Modern Timeline Styles */
.modern-timeline {
    position: relative;
    padding: 2rem 0;
}

.modern-timeline::before {
    content: '';
    position: absolute;
    left: 50%;
    top: 0;
    bottom: 0;
    width: 3px;
    background: linear-gradient(180deg, #007bff 0%, #28a745 50%, #ffc107 100%);
    transform: translateX(-50%);
    border-radius: 2px;
    z-index: 0; /* Vạch kẻ ở dưới cùng */
}

.timeline-item {
    position: relative;
    margin-bottom: 3rem;
    display: flex;
    align-items: flex-start;
    opacity: 1; /* Changed from 0 to 1 to show by default */
    transform: translateY(0); /* Changed from translateY(30px) to 0 */
    transition: all 0.6s ease;
}


.timeline-item:nth-child(odd) {
    flex-direction: row-reverse;
}

.timeline-item:nth-child(odd) .timeline-content {
    text-align: right;
    margin-right: calc(50% + 50px);
    margin-left: 0;
}

.timeline-item:nth-child(even) .timeline-content {
    margin-left: calc(50% + 50px);
    margin-right: 0;
}

.timeline-marker {
    position: absolute;
    left: 50%;
    top: 0;
    transform: translateX(-50%);
    z-index: 10; /* Tăng z-index để marker luôn ở trên */
}

.timeline-icon {
    width: 70px;
    height: 70px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    color: white;
    border: 4px solid white;
    box-shadow: 0 8px 25px rgba(0,0,0,0.15);
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.timeline-icon::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
    transition: left 0.5s ease;
}

.timeline-icon:hover::before {
    left: 100%;
}

.timeline-icon:hover {
    transform: scale(1.1) rotate(5deg);
}

.timeline-icon.status-consultation {
    background: linear-gradient(135deg, #007bff, #0056b3);
}

.timeline-icon.status-planning {
    background: linear-gradient(135deg, #17a2b8, #138496);
}

.timeline-icon.status-production {
    background: linear-gradient(135deg, #ffc107, #e0a800);
}

.timeline-icon.status-installation {
    background: linear-gradient(135deg, #fd7e14, #e8650e);
}

.timeline-icon.status-completion {
    background: linear-gradient(135deg, #28a745, #1e7e34);
}

.timeline-content {
    padding: 0rem;
    flex: 1;
    max-width: 45%;

}

.timeline-card {
    background: white;
    border-radius: 15px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    border: 1px solid rgba(0,123,255,0.1);
    transition: all 0.3s ease;
    overflow: hidden;
    position: relative;
}

.timeline-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(90deg, #007bff, #28a745);
    border-radius: 15px 15px 0 0;
}

.timeline-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 20px 40px rgba(0,0,0,0.15);
    border-color: rgba(0,123,255,0.2);
}

.timeline-card .card-header {
    padding: 1.5rem;
    background: transparent;
    border: none;
    display: flex;
    align-items: center;
    gap: 1rem;
    flex-wrap: wrap;
}

.timeline-item:nth-child(odd) .timeline-card .card-header {
    flex-direction: row-reverse;
}

.step-number {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: linear-gradient(135deg, #007bff, #0056b3);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    font-size: 1.1rem;
    box-shadow: 0 4px 12px rgba(0,123,255,0.3);
    flex-shrink: 0;
}

.step-title {
    margin: 0;
    color: #333;
    font-weight: 600;
    font-size: 1.3rem;
    flex: 1;
    position: relative;
}

.step-title::after {
    content: '';
    position: absolute;
    bottom: -3px;
    left: 0;
    width: 0;
    height: 2px;
    background: linear-gradient(90deg, #007bff, #28a745);
    transition: width 0.3s ease;
}

.timeline-card:hover .step-title::after {
    width: 100%;
}

.status-badge {
    padding: 0.4rem 0.8rem;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    flex-shrink: 0;
    border: 2px solid transparent;
    transition: all 0.3s ease;
}

.status-badge.status-consultation {
    background: rgba(0,123,255,0.1);
    color: #007bff;
    border-color: rgba(0,123,255,0.2);
}

.status-badge.status-planning {
    background: rgba(23,162,184,0.1);
    color: #17a2b8;
    border-color: rgba(23,162,184,0.2);
}

.status-badge.status-production {
    background: rgba(255,193,7,0.1);
    color: #ffc107;
    border-color: rgba(255,193,7,0.2);
}

.status-badge.status-installation {
    background: rgba(253,126,20,0.1);
    color: #fd7e14;
    border-color: rgba(253,126,20,0.2);
}

.status-badge.status-completion {
    background: rgba(40,167,69,0.1);
    color: #28a745;
    border-color: rgba(40,167,69,0.2);
}

.timeline-card .card-body {
    padding: 0 1.5rem 1.5rem;
}

.step-description {
    margin: 0;
    color: #666;
    line-height: 1.6;
    font-size: 1rem;
}

/* Gallery Items Styles */
.gallery-item {
    position: relative;
    cursor: pointer;
    overflow: hidden;
    border-radius: 8px;
    transition: transform 0.3s ease;
}

.gallery-item:hover {
    transform: translateY(-5px);
}

.gallery-image-container {
    position: relative;
    overflow: hidden;
    border-radius: 8px;
}

.gallery-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.6);
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    transition: opacity 0.3s ease;
    color: white;
    text-align: center;
}

.gallery-item:hover .gallery-overlay {
    opacity: 1;
}

.gallery-caption-thumb {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    background: linear-gradient(transparent, rgba(0, 0, 0, 0.8));
    color: white;
    padding: 15px;
    font-size: 14px;
}

.gallery-caption-thumb p {
    margin: 0;
}

/* Modal Gallery Styles */
.swipe-gallery-container {
    position: relative;
    width: 100%;
    height: 80vh;
    max-width: 1200px;
    margin: 0 auto;
}

.swipe-gallery {
    position: relative;
    width: 100%;
    height: 100%;
    overflow: hidden;
    border-radius: 8px;
}

.gallery-wrapper {
    position: relative;
    width: 100%;
    height: 100%;
    display: flex;
    transition: transform 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    touch-action: manipulation;
}

.gallery-slide {
    flex: 0 0 100%;
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
}

.gallery-slide.active {
    display: flex;
}

.gallery-image {
    max-width: 100%;
    max-height: 100%;
    object-fit: contain;
    border-radius: 8px;
}

.gallery-caption {
    position: absolute;
    bottom: 20px;
    left: 20px;
    right: 20px;
    background: rgba(0, 0, 0, 0.7);
    color: white;
    padding: 15px;
    border-radius: 8px;
    text-align: center;
}

.gallery-caption p {
    margin: 0;
    font-size: 16px;
}

/* Navigation Buttons */
.gallery-nav-btn {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    background: rgba(255, 255, 255, 0.9);
    border: none;
    width: 50px;
    height: 50px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 18px;
    color: #333;
    cursor: pointer;
    transition: all 0.3s ease;
    z-index: 10;
}

.gallery-nav-btn:hover {
    background: rgba(255, 255, 255, 1);
    transform: translateY(-50%) scale(1.1);
}

.prev-btn {
    left: 20px;
}

.next-btn {
    right: 20px;
}

/* Counter */
.gallery-counter {
    position: absolute;
    top: 20px;
    right: 20px;
    background: rgba(0, 0, 0, 0.7);
    color: white;
    padding: 8px 15px;
    border-radius: 20px;
    font-size: 14px;
    z-index: 10;
}

/* Dots Indicator */
.gallery-dots {
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 10px;
    z-index: 10;
}

.gallery-dots .dot {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.5);
    cursor: pointer;
    transition: background 0.3s ease;
}

.gallery-dots .dot.active {
    background: rgba(255, 255, 255, 1);
}

.gallery-dots .dot:hover {
    background: rgba(255, 255, 255, 0.8);
}

/* Lightbox Modal Styles */
.lightbox-modal {
    display: none;
    position: fixed;
    z-index: 10000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.9);
    align-items: center;
    justify-content: center;
    backdrop-filter: blur(5px);
}

.lightbox-content {
    position: relative;
    width: 90%;
    height: 90%;
    max-width: 1200px;
    max-height: 800px;
    background: #000;
    border-radius: 10px;
    overflow: hidden;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
}

.lightbox-close {
    position: absolute;
    top: 15px;
    right: 25px;
    color: white;
    font-size: 35px;
    font-weight: bold;
    cursor: pointer;
    z-index: 10001;
    background: rgba(0, 0, 0, 0.5);
    width: 45px;
    height: 45px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
}

.lightbox-close:hover {
    background: rgba(255, 255, 255, 0.2);
    transform: scale(1.1);
}
</style>
{% endblock %}

{% block extra_js %}
<script>
// Modal Gallery with Swipe functionality
class ModalGallery {
    constructor() {
        this.modal = document.getElementById('galleryModal');
        this.gallery = document.getElementById('modalGallery');
        
        if (!this.modal || !this.gallery) return;
        
        this.wrapper = this.gallery.querySelector('.gallery-wrapper');
        this.slides = this.gallery.querySelectorAll('.gallery-slide');
        this.dots = this.gallery.querySelectorAll('.dot');
        this.prevBtn = document.getElementById('modalPrevBtn');
        this.nextBtn = document.getElementById('modalNextBtn');
        this.currentSlideElement = document.getElementById('modalCurrentSlide');
        this.totalSlidesElement = document.getElementById('modalTotalSlides');
        
        this.currentIndex = 0;
        this.totalSlides = this.slides.length;
        
        // Touch/swipe variables
        this.startX = 0;
        this.currentX = 0;
        this.isDragging = false;
        this.dragThreshold = 50; // minimum distance to trigger swipe
        
        this.init();
    }
    
    init() {
        if (this.totalSlides === 0) return;
        
        // Set initial state
        this.updateSlidePosition();
        this.updateCounter();
        this.updateDots();
        
        // Add event listeners
        this.addEventListeners();
        
        // Show/hide navigation if only one slide
        if (this.totalSlides <= 1) {
            this.prevBtn.style.display = 'none';
            this.nextBtn.style.display = 'none';
            this.dots.forEach(dot => dot.style.display = 'none');
        }
    }
    
    addEventListeners() {
        // Navigation buttons
        this.prevBtn?.addEventListener('click', () => this.previousSlide());
        this.nextBtn?.addEventListener('click', () => this.nextSlide());
        
        // Dots navigation
        this.dots.forEach((dot, index) => {
            dot.addEventListener('click', () => this.goToSlide(index));
        });
        
        // Touch events for swipe
        this.wrapper.addEventListener('touchstart', (e) => this.handleTouchStart(e), { passive: false });
        this.wrapper.addEventListener('touchmove', (e) => this.handleTouchMove(e), { passive: false });
        this.wrapper.addEventListener('touchend', (e) => this.handleTouchEnd(e), { passive: false });
        
        // Mouse events for desktop drag
        this.wrapper.addEventListener('mousedown', (e) => this.handleMouseDown(e));
        this.wrapper.addEventListener('mousemove', (e) => this.handleMouseMove(e));
        this.wrapper.addEventListener('mouseup', (e) => this.handleMouseUp(e));
        this.wrapper.addEventListener('mouseleave', (e) => this.handleMouseUp(e));
        
        // Keyboard navigation
        document.addEventListener('keydown', (e) => this.handleKeyDown(e));
        
        // Modal events
        this.modal.addEventListener('shown.bs.modal', () => this.onModalShown());
        this.modal.addEventListener('hidden.bs.modal', () => this.onModalHidden());
    }
      handleTouchStart(e) {
        this.startX = e.touches[0].clientX;
        this.currentX = this.startX;
        this.isDragging = true;
        this.wrapper.style.transition = 'none';
        console.log('👆 Touch start:', this.startX);
    }
    
    handleTouchMove(e) {
        if (!this.isDragging) return;
        
        e.preventDefault();
        this.currentX = e.touches[0].clientX;
        const deltaX = this.currentX - this.startX;
        const currentTransform = -this.currentIndex * 100;
        const newTransform = currentTransform + (deltaX / this.wrapper.offsetWidth) * 100;
        
        this.wrapper.style.transform = `translateX(${newTransform}%)`;
        console.log('👆 Touch move - deltaX:', deltaX, 'newTransform:', newTransform);
    }
    
    handleTouchEnd(e) {
        if (!this.isDragging) return;
        
        this.isDragging = false;
        this.wrapper.style.transition = 'transform 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
        
        const deltaX = this.currentX - this.startX;
        console.log('👆 Touch end - deltaX:', deltaX, 'threshold:', this.dragThreshold);
        
        if (Math.abs(deltaX) > this.dragThreshold) {
            if (deltaX > 0) {
                this.previousSlide();
            } else {
                this.nextSlide();
            }
        } else {
            this.updateSlidePosition();
        }
    }
    
    handleMouseDown(e) {
        e.preventDefault();
        this.startX = e.clientX;
        this.currentX = this.startX;
        this.isDragging = true;
        this.wrapper.style.transition = 'none';
        this.wrapper.style.cursor = 'grabbing';
    }
    
    handleMouseMove(e) {
        if (!this.isDragging) return;
        
        e.preventDefault();
        this.currentX = e.clientX;
        const deltaX = this.currentX - this.startX;
        const currentTransform = -this.currentIndex * 100;
        const newTransform = currentTransform + (deltaX / this.wrapper.offsetWidth) * 100;
        
        this.wrapper.style.transform = `translateX(${newTransform}%)`;
    }
    
    handleMouseUp(e) {
        if (!this.isDragging) return;
        
        this.isDragging = false;
        this.wrapper.style.transition = 'transform 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
        this.wrapper.style.cursor = 'grab';
        
        const deltaX = this.currentX - this.startX;
        
        if (Math.abs(deltaX) > this.dragThreshold) {
            if (deltaX > 0) {
                this.previousSlide();
            } else {
                this.nextSlide();
            }
        } else {
            this.updateSlidePosition();
        }
    }
    
    handleKeyDown(e) {
        if (!this.modal.classList.contains('show')) return;
        
        switch(e.key) {
            case 'ArrowLeft':
                e.preventDefault();
                this.previousSlide();
                break;
            case 'ArrowRight':
                e.preventDefault();
                this.nextSlide();
                break;
            case 'Escape':
                e.preventDefault();
                bootstrap.Modal.getInstance(this.modal).hide();
                break;
        }
    }
    
    nextSlide() {
        this.currentIndex = (this.currentIndex + 1) % this.totalSlides;
        this.updateSlidePosition();
        this.updateCounter();
        this.updateDots();
    }
    
    previousSlide() {
        this.currentIndex = (this.currentIndex - 1 + this.totalSlides) % this.totalSlides;
        this.updateSlidePosition();
        this.updateCounter();
        this.updateDots();
    }
    
    goToSlide(index) {
        this.currentIndex = index;
        this.updateSlidePosition();
        this.updateCounter();
        this.updateDots();
    }
    
    updateSlidePosition() {
        const translateX = -this.currentIndex * 100;
        this.wrapper.style.transform = `translateX(${translateX}%)`;
    }
    
    updateCounter() {
        if (this.currentSlideElement) {
            this.currentSlideElement.textContent = this.currentIndex + 1;
        }
        if (this.totalSlidesElement) {
            this.totalSlidesElement.textContent = this.totalSlides;
        }
    }
    
    updateDots() {
        this.dots.forEach((dot, index) => {
            dot.classList.toggle('active', index === this.currentIndex);
        });
    }
    
    onModalShown() {
        // Enable keyboard navigation
        document.body.style.overflow = 'hidden';
    }
    
    onModalHidden() {
        // Disable keyboard navigation
        document.body.style.overflow = '';
        // Reset to first slide
        this.currentIndex = 0;
        this.updateSlidePosition();
        this.updateCounter();
        this.updateDots();
    }
    
    openModal(slideIndex = 0) {
        this.currentIndex = slideIndex;
        this.updateSlidePosition();
        this.updateCounter();
        this.updateDots();
        
        const modalInstance = new bootstrap.Modal(this.modal);        modalInstance.show();
    }
}

// Initialize modal gallery
document.addEventListener('DOMContentLoaded', function() {
    const modalGallery = new ModalGallery();
    window.modalGalleryInstance = modalGallery;
    
    // Handle Bootstrap modal events
    const galleryModal = document.getElementById('galleryModal');
    if (galleryModal) {
        // When modal is shown, initialize/reset gallery to specific slide
        galleryModal.addEventListener('show.bs.modal', function(event) {
            const button = event.relatedTarget;
            const slideIndex = parseInt(button.getAttribute('data-slide')) || 0;
            
            setTimeout(() => {
                if (modalGallery && modalGallery.goToSlide) {
                    modalGallery.goToSlide(slideIndex);
                }
            }, 150);
        });
        
        // Reset to first slide when modal is hidden
        galleryModal.addEventListener('hidden.bs.modal', function() {
            if (modalGallery && modalGallery.goToSlide) {
                modalGallery.goToSlide(0);
            }
        });
    }
    
    console.log('🖼️ Modal Gallery with Swipe initialized');
});
</script>
{% endblock %}


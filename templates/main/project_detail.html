{% extends 'base.html' %}
{% load static %}
{% load humanize %}

{% block title %}{{ project.title }} - VAV Furniture{% endblock %}

{% block content %}
<!-- Page Header -->
<section class="page-header">
    <div class="container">
        <div class="page-header-content text-center">
            <h1 class="display-4 fw-bold">{{ project.title }}</h1>
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb justify-content-center">
                    <li class="breadcrumb-item"><a href="{% url 'home' %}" class="text-white">Trang Chủ</a></li>
                    <li class="breadcrumb-item"><a href="{% url 'projects' %}" class="text-white">Dự Án</a></li>
                    <li class="breadcrumb-item active text-white" aria-current="page">{{ project.title }}</li>
                </ol>
            </nav>
        </div>
    </div>
</section>

<!-- Project Detail Section -->
<section class="project-detail-section py-5">
    <div class="container">
        <div class="row">
            <!-- Project Image -->
            <div class="col-lg-6 mb-4 mb-lg-0">
                <div class="project-detail-image">
                    <img src="{{ project.image.url }}" alt="{{ project.title }}" class="img-fluid rounded shadow">
                </div>
            </div>
            
            <!-- Project Info -->
            <div class="col-lg-6">
                <div class="project-detail-info">
                    <h2 class="mb-3">{{ project.title }}</h2>
                    
                    <div class="project-type mb-3">
                        <span class="badge bg-primary">{{ project.get_project_type_display }}</span>
                    </div>
                      <div class="project-info-grid mb-4">
                        <div class="row g-3">
                            <div class="col-6">
                                <div class="info-item">
                                    <strong>Khách Hàng:</strong> {{ project.client }}
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="info-item">
                                    <strong>Địa Điểm:</strong> {{ project.location }}
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="info-item">
                                    <strong>Hoàn Thành:</strong> {{ project.completed_date|date:"d/m/Y" }}
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="info-item">
                                    <strong>Loại Dự Án:</strong> {{ project.get_project_type_display }}
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="project-description mb-4">
                        <h5>Mô Tả Dự Án</h5>
                        <p>{{ project.description }}</p>
                    </div>
                    
                    <div class="project-features mb-4">
                        <h5>Đặc Điểm Nổi Bật</h5>
                        <ul class="list-unstyled">
                            <li><i class="fas fa-check-circle text-primary me-2"></i> Thiết kế độc đáo, phù hợp với không gian</li>
                            <li><i class="fas fa-check-circle text-primary me-2"></i> Sử dụng vật liệu cao cấp, bền đẹp</li>
                            <li><i class="fas fa-check-circle text-primary me-2"></i> Thi công chuyên nghiệp, đúng tiến độ</li>
                            <li><i class="fas fa-check-circle text-primary me-2"></i> Bảo hành dài hạn, hỗ trợ sau bán hàng</li>
                        </ul>
                    </div>
                    
                    <div class="project-actions">
                        <a href="{% url 'contact' %}" class="btn btn-primary me-2">
                            <i class="fas fa-phone me-2"></i>Liên Hệ Tư Vấn
                        </a>
                        <a href="#" class="btn btn-outline-primary">
                            <i class="fas fa-share-alt me-2"></i>Chia Sẻ
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Project Gallery Section -->
<section class="project-gallery-section py-5 bg-light">
    <div class="container">
        <div class="section-heading text-center mb-5">
            <h6 class="text-primary">Hình Ảnh Dự Án</h6>
            <h2>Thư Viện Ảnh</h2>
        </div>          
        <div class="row g-4">
            {% if gallery_images %}
                {% for gallery_image in gallery_images %}                <div class="col-md-6 col-lg-4 gallery-image-item {% if forloop.counter > 3 %}d-none{% endif %}">
                    <div class="gallery-item" onclick="openLightbox({{ forloop.counter0 }})">
                        <div class="gallery-image-container">
                            <img src="{{ gallery_image.image.url }}" alt="{{ gallery_image.title|default:project.title }}" class="gallery-image">
                            <div class="gallery-overlay">
                                <i class="fas fa-search-plus fa-2x text-white"></i>
                            </div>
                        </div>
                        {% if gallery_image.title %}
                        <div class="gallery-caption mt-2">
                            <small class="text-muted">{{ gallery_image.title }}</small>
                        </div>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
                
                {% if gallery_images|length > 3 %}
                <div class="col-12 text-center mt-4">
                    <button id="viewMoreBtn" class="btn btn-outline-primary btn-lg">
                        <i class="fas fa-images me-2"></i>Xem Thêm Ảnh Dự Án ({{ gallery_images|length|add:"-3" }} ảnh)
                    </button>
                    <button id="viewLessBtn" class="btn btn-outline-secondary btn-lg d-none">
                        <i class="fas fa-eye-slash me-2"></i>Thu Gọn
                    </button>
                </div>
                {% endif %}
            {% else %}
                <!-- Fallback to main project image if no gallery images -->
                <div class="col-md-6 col-lg-4">
                    <div class="gallery-item">
                        <img src="{{ project.image.url }}" alt="{{ project.title }}" class="img-fluid rounded shadow">
                    </div>
                </div>
                <div class="col-md-6 col-lg-4">
                    <div class="gallery-item">
                        <img src="{{ project.image.url }}" alt="{{ project.title }}" class="img-fluid rounded shadow">
                    </div>
                </div>
                <div class="col-md-6 col-lg-4">
                    <div class="gallery-item">
                        <img src="{{ project.image.url }}" alt="{{ project.title }}" class="img-fluid rounded shadow">
                    </div>
                </div>
            {% endif %}
        </div>
    </div>
</section>

<!-- Project Timeline Section -->
<section class="project-timeline-section py-5 bg-gradient-light">
    <div class="container">
        <div class="section-heading text-center mb-5">
            <div class="section-title-decoration mb-3">
                <span class="decoration-line"></span>
                <i class="fas fa-tasks text-primary"></i>
                <span class="decoration-line"></span>
            </div>
            <h6 class="text-primary text-uppercase fw-bold ls-2 mb-2">Quy Trình Thực Hiện</h6>
            <h2 class="display-5 fw-bold mb-3">Các Giai Đoạn Dự Án</h2>
            <p class="lead text-muted">Quy trình thực hiện dự án một cách chuyên nghiệp và minh bạch</p>        </div>
          {% if timeline_entries %}
        <!-- Dynamic Timeline -->
        <div class="row">
            <div class="col-lg-10 mx-auto">
                <div class="modern-timeline">
                    {% for entry in timeline_entries %}
                    <div class="timeline-item" data-aos="fade-up" data-aos-delay="{% cycle '100' '200' '300' '400' '500' %}">
                        <div class="timeline-marker">
                            <div class="timeline-icon status-{{ entry.status }}">
                                {% if entry.status == 'consultation' %}
                                    <i class="fas fa-lightbulb"></i>
                                {% elif entry.status == 'planning' %}
                                    <i class="fas fa-drafting-compass"></i>
                                {% elif entry.status == 'production' %}
                                    <i class="fas fa-cogs"></i>
                                {% elif entry.status == 'installation' %}
                                    <i class="fas fa-hammer"></i>
                                {% elif entry.status == 'completion' %}
                                    <i class="fas fa-trophy"></i>
                                {% else %}
                                    <i class="fas fa-circle"></i>
                                {% endif %}
                            </div>
                        </div>
                        <div class="timeline-content">
                            <div class="timeline-card">
                                <div class="card-header">
                                    <span class="step-number">{{ forloop.counter }}</span>
                                    <h4 class="step-title">{{ entry.title }}</h4>
                                    <span class="status-badge status-{{ entry.status }}">
                                        {{ entry.get_status_display }}
                                    </span>
                                </div>
                                <div class="card-body">
                                    <p class="step-description">{{ entry.description }}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
        {% else %}        <!-- Default Timeline -->
        <div class="row">
            <div class="col-lg-10 mx-auto">
                <div class="modern-timeline">
                    <div class="timeline-item" data-aos="fade-up" data-aos-delay="100">
                        <div class="timeline-marker">
                            <div class="timeline-icon status-consultation">
                                <i class="fas fa-lightbulb"></i>
                            </div>
                        </div>
                        <div class="timeline-content">
                            <div class="timeline-card">
                                <div class="card-header">
                                    <span class="step-number">1</span>
                                    <h4 class="step-title">Tư Vấn & Thiết Kế</h4>
                                    <span class="status-badge status-consultation">Tư Vấn</span>
                                </div>
                                <div class="card-body">
                                    <p class="step-description">Khảo sát thực tế, phân tích nhu cầu khách hàng và tạo ra bản thiết kế tối ưu phù hợp với không gian và phong cách mong muốn.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="timeline-item" data-aos="fade-up" data-aos-delay="200">
                        <div class="timeline-marker">
                            <div class="timeline-icon status-planning">
                                <i class="fas fa-drafting-compass"></i>
                            </div>
                        </div>
                        <div class="timeline-content">
                            <div class="timeline-card">
                                <div class="card-header">
                                    <span class="step-number">2</span>
                                    <h4 class="step-title">Lập Kế Hoạch & Vật Liệu</h4>
                                    <span class="status-badge status-planning">Lập Kế Hoạch</span>
                                </div>
                                <div class="card-body">
                                    <p class="step-description">Xây dựng kế hoạch thi công chi tiết, lựa chọn vật liệu cao cấp và lên lịch thực hiện cụ thể đảm bảo tiến độ.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="timeline-item" data-aos="fade-up" data-aos-delay="300">
                        <div class="timeline-marker">
                            <div class="timeline-icon status-production">
                                <i class="fas fa-cogs"></i>
                            </div>
                        </div>
                        <div class="timeline-content">
                            <div class="timeline-card">
                                <div class="card-header">
                                    <span class="step-number">3</span>
                                    <h4 class="step-title">Sản Xuất & Chế Tác</h4>
                                    <span class="status-badge status-production">Sản Xuất</span>
                                </div>
                                <div class="card-body">
                                    <p class="step-description">Sản xuất nội thất theo thiết kế với công nghệ hiện đại, kiểm soát chất lượng nghiêm ngặt từng sản phẩm.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="timeline-item" data-aos="fade-up" data-aos-delay="400">
                        <div class="timeline-marker">
                            <div class="timeline-icon status-installation">
                                <i class="fas fa-hammer"></i>
                            </div>
                        </div>
                        <div class="timeline-content">
                            <div class="timeline-card">
                                <div class="card-header">
                                    <span class="step-number">4</span>
                                    <h4 class="step-title">Thi Công & Lắp Đặt</h4>
                                    <span class="status-badge status-installation">Thi Công</span>
                                </div>
                                <div class="card-body">
                                    <p class="step-description">Thi công và lắp đặt chuyên nghiệp tại công trình, đảm bảo tiến độ và chất lượng hoàn hảo.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="timeline-item" data-aos="fade-up" data-aos-delay="500">
                        <div class="timeline-marker">
                            <div class="timeline-icon status-completion">
                                <i class="fas fa-trophy"></i>
                            </div>
                        </div>
                        <div class="timeline-content">
                            <div class="timeline-card">
                                <div class="card-header">
                                    <span class="step-number">5</span>
                                    <h4 class="step-title">Nghiệm Thu & Bàn Giao</h4>
                                    <span class="status-badge status-completion">Hoàn Thành</span>
                                </div>
                                <div class="card-body">
                                    <p class="step-description">Hoàn thiện dự án, kiểm tra chất lượng tổng thể và bàn giao công trình hoàn chỉnh cho khách hàng cùng chế độ bảo hành.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
    </div>
</section>

<!-- Lightbox Modal -->
<div id="lightboxModal" class="lightbox-modal" onclick="closeLightbox(event)">
    <div class="lightbox-content">
        <span class="lightbox-close" onclick="closeLightbox()">&times;</span>
        <button class="lightbox-nav lightbox-prev" onclick="changeImage(-1)">
            <i class="fas fa-chevron-left"></i>
        </button>
        <button class="lightbox-nav lightbox-next" onclick="changeImage(1)">
            <i class="fas fa-chevron-right"></i>
        </button>
        <img id="lightboxImage" src="" alt="">
        <div class="lightbox-caption">
            <p id="lightboxTitle"></p>
            <span id="lightboxCounter"></span>
        </div>
    </div>
</div>

<!-- Related Projects Section -->
<section class="related-projects-section py-5 bg-light">
    <div class="container">
        <div class="section-heading text-center mb-5">
            <h6 class="text-primary">Dự Án Tương Tự</h6>
            <h2>Các Dự Án Khác</h2>
        </div>
        
        <div class="row g-4">
            {% for related_project in related_projects %}
            <!-- Related Project Item {{ forloop.counter }} -->
            <div class="col-md-6 col-lg-4">
                <div class="project-card">
                    <div class="project-image">
                        <img src="{{ related_project.image.url }}" alt="{{ related_project.title }}" class="img-fluid">
                        <div class="project-overlay">
                            <div class="project-info">
                                <h5>{{ related_project.title }}</h5>
                                <p><i class="fas fa-map-marker-alt me-1"></i>{{ related_project.location }}</p>
                                <a href="{% url 'project_detail' related_project.slug %}" class="btn btn-sm btn-outline-light">Xem Chi Tiết</a>
                            </div>
                        </div>
                    </div>
                    <div class="project-meta p-3">
                        <div class="d-flex justify-content-between align-items-center">
                            <span class="badge bg-primary">{{ related_project.get_project_type_display }}</span>
                            <small class="text-muted">{{ related_project.completed_date|date:"Y" }}</small>
                        </div>
                    </div>
                </div>
            </div>
            {% empty %}
            <div class="col-12 text-center">
                <p>Không có dự án liên quan.</p>
            </div>
            {% endfor %}
        </div>
    </div>
</section>

<!-- CTA Section -->
<section class="cta-section py-5 bg-primary text-white">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-8 mb-4 mb-lg-0">
                <h2 class="mb-2">Bạn Có Dự Án Tương Tự?</h2>
                <p class="lead mb-0">Hãy liên hệ với chúng tôi để được tư vấn thiết kế và báo giá chi tiết!</p>
            </div>
            <div class="col-lg-4 text-lg-end">
                <a href="{% url 'contact' %}" class="btn btn-light btn-lg">
                    <i class="fas fa-phone me-2"></i>Liên Hệ Ngay
                </a>
            </div>
        </div>
    </div>
</section>

{% block extra_css %}
<style>
/* Enhanced Timeline Styles */
.bg-gradient-light {
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
}

.section-title-decoration {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 1rem;
}

.decoration-line {
    width: 60px;
    height: 2px;
    background: linear-gradient(90deg, transparent, #007bff, transparent);
}

.ls-2 {
    letter-spacing: 2px;
}

/* Modern Timeline Styles */
.modern-timeline {
    position: relative;
    padding: 2rem 0;
}

.modern-timeline::before {
    content: '';
    position: absolute;
    left: 50%;
    top: 0;
    bottom: 0;
    width: 3px;
    background: linear-gradient(180deg, #007bff 0%, #28a745 50%, #ffc107 100%);
    transform: translateX(-50%);
    border-radius: 2px;
    z-index: 0; /* Vạch kẻ ở dưới cùng */
}

.timeline-item {
    position: relative;
    margin-bottom: 3rem;
    display: flex;
    align-items: flex-start;
    opacity: 1; /* Changed from 0 to 1 to show by default */
    transform: translateY(0); /* Changed from translateY(30px) to 0 */
    transition: all 0.6s ease;
}


.timeline-item:nth-child(odd) {
    flex-direction: row-reverse;
}

.timeline-item:nth-child(odd) .timeline-content {
    text-align: right;
    margin-right: calc(50% + 50px);
    margin-left: 0;
}

.timeline-item:nth-child(even) .timeline-content {
    margin-left: calc(50% + 50px);
    margin-right: 0;
}

.timeline-marker {
    position: absolute;
    left: 50%;
    top: 0;
    transform: translateX(-50%);
    z-index: 10; /* Tăng z-index để marker luôn ở trên */
}

.timeline-icon {
    width: 70px;
    height: 70px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    color: white;
    border: 4px solid white;
    box-shadow: 0 8px 25px rgba(0,0,0,0.15);
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.timeline-icon::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
    transition: left 0.5s ease;
}

.timeline-icon:hover::before {
    left: 100%;
}

.timeline-icon:hover {
    transform: scale(1.1) rotate(5deg);
}

.timeline-icon.status-consultation {
    background: linear-gradient(135deg, #007bff, #0056b3);
}

.timeline-icon.status-planning {
    background: linear-gradient(135deg, #17a2b8, #138496);
}

.timeline-icon.status-production {
    background: linear-gradient(135deg, #ffc107, #e0a800);
}

.timeline-icon.status-installation {
    background: linear-gradient(135deg, #fd7e14, #e8650e);
}

.timeline-icon.status-completion {
    background: linear-gradient(135deg, #28a745, #1e7e34);
}

.timeline-content {
    padding: 0rem;
    flex: 1;
    max-width: 45%;

}

.timeline-card {
    background: white;
    border-radius: 15px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    border: 1px solid rgba(0,123,255,0.1);
    transition: all 0.3s ease;
    overflow: hidden;
    position: relative;
}

.timeline-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(90deg, #007bff, #28a745);
    border-radius: 15px 15px 0 0;
}

.timeline-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 20px 40px rgba(0,0,0,0.15);
    border-color: rgba(0,123,255,0.2);
}

.timeline-card .card-header {
    padding: 1.5rem;
    background: transparent;
    border: none;
    display: flex;
    align-items: center;
    gap: 1rem;
    flex-wrap: wrap;
}

.timeline-item:nth-child(odd) .timeline-card .card-header {
    flex-direction: row-reverse;
}

.step-number {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: linear-gradient(135deg, #007bff, #0056b3);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    font-size: 1.1rem;
    box-shadow: 0 4px 12px rgba(0,123,255,0.3);
    flex-shrink: 0;
}

.step-title {
    margin: 0;
    color: #333;
    font-weight: 600;
    font-size: 1.3rem;
    flex: 1;
    position: relative;
}

.step-title::after {
    content: '';
    position: absolute;
    bottom: -3px;
    left: 0;
    width: 0;
    height: 2px;
    background: linear-gradient(90deg, #007bff, #28a745);
    transition: width 0.3s ease;
}

.timeline-card:hover .step-title::after {
    width: 100%;
}

.status-badge {
    padding: 0.4rem 0.8rem;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    flex-shrink: 0;
    border: 2px solid transparent;
    transition: all 0.3s ease;
}

.status-badge.status-consultation {
    background: rgba(0,123,255,0.1);
    color: #007bff;
    border-color: rgba(0,123,255,0.2);
}

.status-badge.status-planning {
    background: rgba(23,162,184,0.1);
    color: #17a2b8;
    border-color: rgba(23,162,184,0.2);
}

.status-badge.status-production {
    background: rgba(255,193,7,0.1);
    color: #ffc107;
    border-color: rgba(255,193,7,0.2);
}

.status-badge.status-installation {
    background: rgba(253,126,20,0.1);
    color: #fd7e14;
    border-color: rgba(253,126,20,0.2);
}

.status-badge.status-completion {
    background: rgba(40,167,69,0.1);
    color: #28a745;
    border-color: rgba(40,167,69,0.2);
}

.timeline-card .card-body {
    padding: 0 1.5rem 1.5rem;
}

.step-description {
    margin: 0;
    color: #666;
    line-height: 1.6;
    font-size: 1rem;
}

/* Mobile Responsive */
@media (max-width: 768px) {
    .modern-timeline::before {
        left: 30px;
    }
    
    .timeline-item {
        flex-direction: row !important;
        margin-bottom: 2rem;
    }
    
    .timeline-item:nth-child(odd) .timeline-content,
    .timeline-item:nth-child(even) .timeline-content {
        margin-left: 80px;
        margin-right: 0;
        text-align: left;
        max-width: calc(100% - 100px);
    }
    
    .timeline-marker {
        left: 30px;
    }
    
    .timeline-icon {
        width: 60px;
        height: 60px;
        font-size: 1.3rem;
    }
    
    .timeline-card .card-header {
        flex-direction: row !important;
        padding: 1rem;
    }
    
    .step-title {
        font-size: 1.1rem;
    }
    
    .step-number {
        width: 35px;
        height: 35px;
        font-size: 1rem;
    }
}

.gallery-item {
    overflow: hidden;
    border-radius: 8px;
    transition: transform 0.3s ease;
    cursor: pointer;
}

.gallery-item:hover {
    transform: translateY(-5px);
}

.gallery-image-container {
    position: relative;
    width: 100%;
    height: 300px; /* Fixed height for uniform images */
    overflow: hidden;
    border-radius: 8px;
    background: #f8f9fa;
}

.gallery-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s ease;
}

.gallery-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.7);
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    transition: opacity 0.3s ease;
}

.gallery-item:hover .gallery-overlay {
    opacity: 1;
}

.gallery-item:hover .gallery-image {
    transform: scale(1.1);
}

/* Lightbox Modal Styles */
.lightbox-modal {
    display: none;
    position: fixed;
    z-index: 9999;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.9);
    backdrop-filter: blur(5px);
}

.lightbox-content {
    position: relative;
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-direction: column;
}

.lightbox-close {
    position: absolute;
    top: 20px;
    right: 35px;
    color: white;
    font-size: 40px;
    font-weight: bold;
    cursor: pointer;
    z-index: 10000;
    transition: color 0.3s ease;
}

.lightbox-close:hover {
    color: #007bff;
}

.lightbox-nav {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    background: rgba(255, 255, 255, 0.2);
    border: none;
    color: white;
    font-size: 24px;
    padding: 20px 15px;
    cursor: pointer;
    border-radius: 50%;
    transition: all 0.3s ease;
    z-index: 10000;
}

.lightbox-nav:hover {
    background: rgba(255, 255, 255, 0.3);
    color: #007bff;
    transform: translateY(-50%) scale(1.1);
}

.lightbox-prev {
    left: 30px;
}

.lightbox-next {
    right: 30px;
}

#lightboxImage {
    max-width: 90%;
    max-height: 80%;
    object-fit: contain;
    border-radius: 8px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
}

.lightbox-caption {
    position: absolute;
    bottom: 30px;
    left: 50%;
    transform: translateX(-50%);
    color: white;
    text-align: center;
    background: rgba(0, 0, 0, 0.7);
    padding: 15px 25px;
    border-radius: 25px;
    max-width: 80%;
}

.lightbox-caption p {
    margin: 0 0 5px 0;
    font-size: 18px;
    font-weight: 500;
}

.lightbox-caption span {
    font-size: 14px;
    opacity: 0.8;
}

.gallery-image-item {
    transition: all 0.3s ease;
}

.gallery-image-item.d-none {
    display: none !important;
}

#viewMoreBtn, #viewLessBtn {
    transition: all 0.3s ease;
    border-width: 2px;
    padding: 0.75rem 2rem;
    font-weight: 600;
}

#viewMoreBtn:hover, #viewLessBtn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,123,255,0.2);
}

/* Responsive Lightbox */
@media (max-width: 768px) {
    .lightbox-close {
        top: 15px;
        right: 20px;
        font-size: 30px;
    }
    
    .lightbox-nav {
        font-size: 20px;
        padding: 15px 12px;
    }
    
    .lightbox-prev {
        left: 15px;
    }
    
    .lightbox-next {
        right: 15px;
    }
    
    #lightboxImage {
        max-width: 95%;
        max-height: 75%;
    }
    
    .lightbox-caption {
        bottom: 20px;
        padding: 10px 20px;
        max-width: 90%;
    }
    
    .lightbox-caption p {
        font-size: 16px;
    }
    
    .gallery-image-container {
        height: 250px;
    }
}

.project-info-grid .info-item {
    margin-bottom: 1rem;
}

.project-info-grid .info-item strong {
    display: block;
    margin-bottom: 0.25rem;
}
</style>
{% endblock %}

{% block extra_js %}
<script>
// Gallery images data
const galleryImages = [
    {% for gallery_image in gallery_images %}
    {
        src: "{{ gallery_image.image.url }}",
        title: "{{ gallery_image.title|default:project.title|escapejs }}",
        alt: "{{ gallery_image.title|default:project.title|escapejs }}"
    }{% if not forloop.last %},{% endif %}
    {% endfor %}
];

let currentImageIndex = 0;

// Enhanced Timeline Animations
function initTimelineAnimations() {
    // Intersection Observer for timeline items
    const timelineItems = document.querySelectorAll('.timeline-item-enhanced');
    
    const timelineObserver = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.classList.add('aos-animate');
                
                // Animate progress bars
                const progressBar = entry.target.querySelector('.progress-bar-enhanced');
                if (progressBar) {
                    const progress = progressBar.getAttribute('data-progress');
                    setTimeout(() => {
                        progressBar.style.width = progress + '%';
                    }, 300);
                }
                
                // Animate circular progress
                const circularProgress = entry.target.querySelector('.circular-progress');
                if (circularProgress) {
                    const progress = circularProgress.getAttribute('data-progress');
                    setTimeout(() => {
                        circularProgress.style.setProperty('--progress', progress + '%');
                    }, 500);
                }
            }
        });
    }, {
        threshold: 0.1,
        rootMargin: '0px 0px -50px 0px'
    });
    
    timelineItems.forEach(item => {
        timelineObserver.observe(item);
    });
    
    // Animate progress circle in dashboard
    const progressCircle = document.querySelector('.circle-progress-bar');
    if (progressCircle) {
        const progressValue = progressCircle.closest('.circle-progress').getAttribute('data-progress');
        const circumference = 100;
        const offset = circumference - (progressValue / 100) * circumference;
        
        setTimeout(() => {
            progressCircle.style.strokeDashoffset = offset;
        }, 500);
    }
}

// Smooth reveal animation for timeline line
function animateTimelineLine() {
    const timelineLine = document.querySelector('.timeline-line');
    if (timelineLine) {
        timelineLine.style.height = '0%';
        timelineLine.style.transition = 'height 2s ease-in-out';
        
        setTimeout(() => {
            timelineLine.style.height = '100%';
        }, 300);
    }
}

// Enhanced hover effects for timeline cards
function initTimelineHoverEffects() {
    const timelineCards = document.querySelectorAll('.timeline-card');
    
    timelineCards.forEach(card => {
        card.addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(-8px) scale(1.02)';
            
            const icon = this.closest('.timeline-item-enhanced').querySelector('.timeline-icon-enhanced');
            if (icon) {
                icon.style.transform = 'scale(1.15) rotate(5deg)';
            }
        });
        
        card.addEventListener('mouseleave', function() {
            this.style.transform = 'translateY(-5px)';
            
            const icon = this.closest('.timeline-item-enhanced').querySelector('.timeline-icon-enhanced');
            if (icon) {
                icon.style.transform = 'scale(1.1) rotate(0deg)';
            }
        });
    });
}

// Parallax effect for timeline
function initTimelineParallax() {
    window.addEventListener('scroll', function() {
        const scrolled = window.pageYOffset;
        const timelineSection = document.querySelector('.project-timeline-section');
        
        if (timelineSection) {
            const rect = timelineSection.getBoundingClientRect();
            const speed = 0.1;
            
            if (rect.top < window.innerHeight && rect.bottom > 0) {
                const timelineItems = document.querySelectorAll('.timeline-item-enhanced');
                timelineItems.forEach((item, index) => {
                    const offset = (scrolled - timelineSection.offsetTop) * speed * (index % 2 === 0 ? 1 : -1);
                    item.style.transform = `translateY(${Math.max(-20, Math.min(20, offset))}px)`;
                });
            }
        }
    });
}

// Open lightbox
function openLightbox(index) {
    currentImageIndex = index;
    const modal = document.getElementById('lightboxModal');
    const img = document.getElementById('lightboxImage');
    const title = document.getElementById('lightboxTitle');
    const counter = document.getElementById('lightboxCounter');
    
    if (galleryImages[index]) {
        img.src = galleryImages[index].src;
        img.alt = galleryImages[index].alt;
        title.textContent = galleryImages[index].title;
        counter.textContent = `${index + 1} / ${galleryImages.length}`;
        
        modal.style.display = 'block';
        document.body.style.overflow = 'hidden';
        
        // Add animation
        setTimeout(() => {
            modal.style.opacity = '1';
        }, 10);
    }
}

// Close lightbox
function closeLightbox(event) {
    if (event && event.target !== event.currentTarget) return;
    
    const modal = document.getElementById('lightboxModal');
    modal.style.opacity = '0';
    
    setTimeout(() => {
        modal.style.display = 'none';
        document.body.style.overflow = '';
    }, 300);
}

// Change image in lightbox
function changeImage(direction) {
    currentImageIndex += direction;
    
    // Loop around
    if (currentImageIndex >= galleryImages.length) {
        currentImageIndex = 0;
    } else if (currentImageIndex < 0) {
        currentImageIndex = galleryImages.length - 1;
    }
    
    const img = document.getElementById('lightboxImage');
    const title = document.getElementById('lightboxTitle');
    const counter = document.getElementById('lightboxCounter');
    
    // Add fade effect
    img.style.opacity = '0';
    
    setTimeout(() => {
        img.src = galleryImages[currentImageIndex].src;
        img.alt = galleryImages[currentImageIndex].alt;
        title.textContent = galleryImages[currentImageIndex].title;
        counter.textContent = `${currentImageIndex + 1} / ${galleryImages.length}`;
        img.style.opacity = '1';
    }, 150);
}

// Keyboard navigation
document.addEventListener('keydown', function(event) {
    const modal = document.getElementById('lightboxModal');
    if (modal.style.display === 'block') {
        switch(event.key) {
            case 'Escape':
                closeLightbox();
                break;
            case 'ArrowLeft':
                changeImage(-1);
                break;
            case 'ArrowRight':
                changeImage(1);
                break;
        }
    }
});

// View More/Less functionality
document.addEventListener('DOMContentLoaded', function() {
    // Initialize AOS (Animate On Scroll)
    if (typeof AOS !== 'undefined') {
        AOS.init({
            duration: 600,
            easing: 'ease-in-out',
            once: true,
            offset: 100
        });
    }
    
    // Initialize timeline animations
    initTimelineAnimations();
    animateTimelineLine();
    initTimelineHoverEffects();
    
    // Initialize parallax on desktop only
    if (window.innerWidth > 768) {
        initTimelineParallax();
    }
    
    // Gallery functionality
    const viewMoreBtn = document.getElementById('viewMoreBtn');
    const viewLessBtn = document.getElementById('viewLessBtn');
    const hiddenImages = document.querySelectorAll('.gallery-image-item.d-none');
    
    if (viewMoreBtn) {
        viewMoreBtn.addEventListener('click', function() {
            // Show all hidden images with animation
            hiddenImages.forEach(function(image, index) {
                setTimeout(function() {
                    image.classList.remove('d-none');
                    image.style.opacity = '0';
                    image.style.transform = 'translateY(20px)';
                    
                    // Trigger animation
                    setTimeout(function() {
                        image.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
                        image.style.opacity = '1';
                        image.style.transform = 'translateY(0)';
                    }, 10);
                }, index * 100); // Stagger the animation
            });
            
            // Switch buttons
            viewMoreBtn.classList.add('d-none');
            viewLessBtn.classList.remove('d-none');
            
            // Smooth scroll to show new images
            setTimeout(function() {
                const firstHiddenImage = document.querySelector('.gallery-image-item:nth-child(4)');
                if (firstHiddenImage) {
                    firstHiddenImage.scrollIntoView({ 
                        behavior: 'smooth', 
                        block: 'center' 
                    });
                }
            }, 300);
        });
    }
    
    if (viewLessBtn) {
        viewLessBtn.addEventListener('click', function() {
            // Hide images beyond the first 3
            const allImages = document.querySelectorAll('.gallery-image-item');
            
            allImages.forEach(function(image, index) {
                if (index >= 3) {
                    image.style.transition = 'opacity 0.3s ease, transform 0.3s ease';
                    image.style.opacity = '0';
                    image.style.transform = 'translateY(-20px)';
                    
                    setTimeout(function() {
                        image.classList.add('d-none');
                        image.style.transform = 'translateY(0)';
                    }, 300);
                }
            });
            
            // Switch buttons
            viewLessBtn.classList.add('d-none');
            viewMoreBtn.classList.remove('d-none');
            
            // Scroll back to gallery section
            const gallerySection = document.querySelector('.project-gallery-section');
            if (gallerySection) {
                gallerySection.scrollIntoView({ 
                    behavior: 'smooth', 
                    block: 'start' 
                });
            }
        });
    }
    
    // Smooth scroll for timeline navigation
    const timelineItems = document.querySelectorAll('.timeline-item-enhanced');
    timelineItems.forEach((item, index) => {
        item.addEventListener('click', function() {
            this.scrollIntoView({ 
                behavior: 'smooth', 
                block: 'center' 
            });
        });
    });
    
    // Add loading animation completion
    setTimeout(() => {
        document.body.classList.add('timeline-loaded');
    }, 1000);
});

// Resize handler
window.addEventListener('resize', function() {
    // Reinitialize parallax only on desktop
    if (window.innerWidth > 768) {
        initTimelineParallax();
    }
});
</script>
{% endblock %}
{% endblock %}
